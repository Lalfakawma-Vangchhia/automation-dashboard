{"ast":null,"code":"var _jsxFileName = \"F:\\\\Projects\\\\Automation Dashboard\\\\frontend\\\\src\\\\components\\\\InstagramPage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport apiClient from '../services/apiClient';\nimport './SocialMediaPage.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst InstagramPage = () => {\n  _s();\n  const [isConnected, setIsConnected] = useState(false);\n  const [instagramAccounts, setInstagramAccounts] = useState([]);\n  const [selectedAccount, setSelectedAccount] = useState('');\n  const [postContent, setPostContent] = useState('');\n  const [postImage, setPostImage] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [message, setMessage] = useState('');\n  const [sdkLoaded, setSdkLoaded] = useState(false);\n  const [fbAccessToken, setFbAccessToken] = useState(null);\n  const [generatingAI, setGeneratingAI] = useState(false);\n  const [userMedia, setUserMedia] = useState([]);\n  const [loadingMedia, setLoadingMedia] = useState(false);\n\n  // Instagram App ID (different from Facebook App ID)\n  const INSTAGRAM_APP_ID = process.env.REACT_APP_INSTAGRAM_APP_ID || '697225659875731';\n  useEffect(() => {\n    const checkLoginStatus = () => {\n      if (!window.FB) return;\n      window.FB.getLoginStatus(response => {\n        if (response.status === 'connected') {\n          setFbAccessToken(response.authResponse.accessToken);\n          setMessage('Instagram: Using existing Facebook login session');\n          // Auto-connect Instagram accounts if we have a token\n          handleConnectInstagram(response.authResponse.accessToken);\n        }\n      });\n    };\n    const initializeFacebookSDK = () => {\n      // Always reinitialize with Instagram App ID to avoid conflicts\n      if (window.FB) {\n        // SDK already exists, reinitialize with Instagram App ID\n        window.FB.init({\n          appId: INSTAGRAM_APP_ID,\n          cookie: true,\n          xfbml: true,\n          version: 'v18.0'\n        });\n        setSdkLoaded(true);\n        checkLoginStatus();\n        return;\n      }\n\n      // Load FB SDK for the first time\n      window.fbAsyncInit = function () {\n        window.FB.init({\n          appId: INSTAGRAM_APP_ID,\n          cookie: true,\n          xfbml: true,\n          version: 'v18.0'\n        });\n        setSdkLoaded(true);\n        checkLoginStatus();\n      };\n\n      // Load the SDK script\n      (function (d, s, id) {\n        var js,\n          fjs = d.getElementsByTagName(s)[0];\n        if (d.getElementById(id)) return;\n        js = d.createElement(s);\n        js.id = id;\n        js.src = \"https://connect.facebook.net/en_US/sdk.js\";\n        fjs.parentNode.insertBefore(js, fjs);\n      })(document, 'script', 'facebook-jssdk');\n    };\n    initializeFacebookSDK();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [INSTAGRAM_APP_ID]);\n  const handleConnectInstagram = async (accessToken = fbAccessToken) => {\n    if (!accessToken) {\n      setMessage('No access token available');\n      setLoading(false);\n      return;\n    }\n    try {\n      setMessage('Fetching Instagram Business accounts...');\n      const response = await apiClient.connectInstagram(accessToken);\n      if (response.success && response.instagram_accounts && response.instagram_accounts.length > 0) {\n        setInstagramAccounts(response.instagram_accounts);\n        setIsConnected(true);\n        setMessage(`Found ${response.instagram_accounts.length} Instagram Business account(s)!`);\n\n        // Auto-select first account if only one\n        if (response.instagram_accounts.length === 1) {\n          setSelectedAccount(response.instagram_accounts[0].id);\n        }\n      } else {\n        setMessage('No Instagram Business accounts found. Make sure you have an Instagram Business account connected to your Facebook Page.');\n      }\n    } catch (error) {\n      console.error('Instagram connection error:', error);\n\n      // Better error handling to avoid [object Object] display\n      let errorMessage = 'Unknown error occurred';\n      if (typeof error === 'string') {\n        errorMessage = error;\n      } else if (error.message) {\n        errorMessage = error.message;\n      } else if (error.response && error.response.data && error.response.data.detail) {\n        errorMessage = error.response.data.detail;\n      } else if (error.detail) {\n        errorMessage = error.detail;\n      }\n      setMessage(`Error connecting Instagram: ${errorMessage}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n  const handleFacebookLogin = () => {\n    if (!window.FB) {\n      setMessage('Facebook SDK not loaded');\n      return;\n    }\n    setLoading(true);\n    setMessage('Initiating Instagram OAuth via Facebook...');\n\n    // Instagram requires specific permissions\n    window.FB.login(response => {\n      if (response.status === 'connected') {\n        const accessToken = response.authResponse.accessToken;\n        setFbAccessToken(accessToken);\n        setMessage('Facebook login successful! Connecting Instagram accounts...');\n        handleConnectInstagram(accessToken);\n      } else {\n        setMessage('Facebook login failed or was cancelled');\n        setLoading(false);\n      }\n    }, {\n      scope: 'pages_show_list,instagram_basic,instagram_content_publish,pages_read_engagement'\n    });\n  };\n  const handleGenerateAIPost = async () => {\n    if (!selectedAccount) {\n      setMessage('Please select an Instagram account first');\n      return;\n    }\n    setGeneratingAI(true);\n    setMessage('Generating AI post...');\n    try {\n      const response = await apiClient.createInstagramPost({\n        instagram_user_id: selectedAccount,\n        access_token: fbAccessToken,\n        use_ai: true,\n        prompt: 'Create an engaging Instagram post'\n      });\n      if (response.success) {\n        setPostContent(response.ai_content || '');\n        setMessage('AI post generated successfully!');\n      } else {\n        setMessage(`Failed to generate AI post: ${response.error}`);\n      }\n    } catch (error) {\n      var _error$response, _error$response$data;\n      console.error('AI generation error:', error);\n      setMessage(`Error generating AI post: ${((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.detail) || error.message}`);\n    } finally {\n      setGeneratingAI(false);\n    }\n  };\n  const handleCreatePost = async () => {\n    if (!selectedAccount || !postContent.trim()) {\n      setMessage('Please select an account and enter post content');\n      return;\n    }\n    setLoading(true);\n    setMessage('Creating Instagram post...');\n    try {\n      const formData = new FormData();\n      formData.append('instagram_user_id', selectedAccount);\n      formData.append('access_token', fbAccessToken);\n      formData.append('caption', postContent);\n      formData.append('use_ai', 'false');\n      if (postImage) {\n        formData.append('image', postImage);\n      }\n      const response = await apiClient.createInstagramPost(formData);\n      if (response.success) {\n        setMessage('Instagram post created successfully!');\n        setPostContent('');\n        setPostImage(null);\n        // Refresh media after posting\n        if (selectedAccount) {\n          loadUserMedia(selectedAccount);\n        }\n      } else {\n        setMessage(`Failed to create post: ${response.error}`);\n      }\n    } catch (error) {\n      var _error$response2, _error$response2$data;\n      console.error('Post creation error:', error);\n      setMessage(`Error creating post: ${((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.detail) || error.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n  const loadUserMedia = async instagramUserId => {\n    setLoadingMedia(true);\n    try {\n      const media = await apiClient.getInstagramMedia(instagramUserId);\n      setUserMedia(media || []);\n    } catch (error) {\n      var _error$response3, _error$response3$data;\n      console.error('Error loading media:', error);\n      setMessage(`Error loading media: ${((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : (_error$response3$data = _error$response3.data) === null || _error$response3$data === void 0 ? void 0 : _error$response3$data.detail) || error.message}`);\n    } finally {\n      setLoadingMedia(false);\n    }\n  };\n  const handleAccountChange = accountId => {\n    setSelectedAccount(accountId);\n    if (accountId) {\n      loadUserMedia(accountId);\n    }\n  };\n  const handleImageChange = e => {\n    const file = e.target.files[0];\n    if (file) {\n      setPostImage(file);\n    }\n  };\n  const handleLogout = () => {\n    if (window.FB) {\n      window.FB.logout(() => {\n        setIsConnected(false);\n        setInstagramAccounts([]);\n        setSelectedAccount('');\n        setFbAccessToken(null);\n        setUserMedia([]);\n        setMessage('Logged out successfully');\n      });\n    }\n  };\n  if (!sdkLoaded) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"social-media-page\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"loading\",\n        children: \"Loading Instagram SDK...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"social-media-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"page-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Instagram Management\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Connect and manage your Instagram Business accounts\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 272,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 7\n    }, this), message && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `message ${message.includes('Error') || message.includes('Failed') ? 'error' : 'success'}`,\n      children: message\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 9\n    }, this), !isConnected ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"connection-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Connect Instagram Account\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Connect your Instagram Business account through Facebook to start posting and managing content.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleFacebookLogin,\n        disabled: loading,\n        className: \"connect-button\",\n        children: loading ? 'Connecting...' : 'Connect Instagram via Facebook'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"instagram-requirements\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Requirements:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: [/*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Instagram Business or Creator account\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Connected to a Facebook Page\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 296,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Admin access to the Facebook Page\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 282,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"connected-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"account-selection\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Instagram Accounts\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 304,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          value: selectedAccount,\n          onChange: e => handleAccountChange(e.target.value),\n          className: \"account-select\",\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"\",\n            children: \"Select an Instagram account\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 310,\n            columnNumber: 15\n          }, this), instagramAccounts.map(account => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: account.id,\n            children: [account.username, \" (\", account.name, \")\"]\n          }, account.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 17\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 305,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleLogout,\n          className: \"logout-button\",\n          children: \"Disconnect Instagram\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 303,\n        columnNumber: 11\n      }, this), selectedAccount && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"posting-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"Create Instagram Post\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ai-section\",\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"AI-Generated Post\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 329,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: handleGenerateAIPost,\n              disabled: generatingAI || loading,\n              className: \"ai-button\",\n              children: generatingAI ? 'Generating...' : 'Generate AI Post'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 330,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 328,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"manual-post-section\",\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"Manual Post\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 340,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n              value: postContent,\n              onChange: e => setPostContent(e.target.value),\n              placeholder: \"Enter your Instagram caption...\",\n              rows: \"4\",\n              className: \"post-textarea\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 341,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"image-upload\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                htmlFor: \"image-upload\",\n                children: \"Choose Image:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 350,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                id: \"image-upload\",\n                type: \"file\",\n                accept: \"image/*\",\n                onChange: handleImageChange,\n                className: \"file-input\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 351,\n                columnNumber: 21\n              }, this), postImage && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"image-preview\",\n                children: /*#__PURE__*/_jsxDEV(\"p\", {\n                  children: [\"Selected: \", postImage.name]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 360,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 359,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 349,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: handleCreatePost,\n              disabled: loading || !postContent.trim(),\n              className: \"post-button\",\n              children: loading ? 'Posting...' : 'Create Post'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 365,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 339,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"media-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"Recent Posts\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 376,\n            columnNumber: 17\n          }, this), loadingMedia ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"loading\",\n            children: \"Loading media...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 378,\n            columnNumber: 19\n          }, this) : userMedia.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"media-grid\",\n            children: userMedia.slice(0, 12).map(media => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"media-item\",\n              children: [media.media_type === 'IMAGE' ? /*#__PURE__*/_jsxDEV(\"img\", {\n                src: media.media_url,\n                alt: \"Instagram post\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 384,\n                columnNumber: 27\n              }, this) : media.media_type === 'VIDEO' ? /*#__PURE__*/_jsxDEV(\"video\", {\n                controls: true,\n                children: /*#__PURE__*/_jsxDEV(\"source\", {\n                  src: media.media_url,\n                  type: \"video/mp4\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 387,\n                  columnNumber: 29\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 386,\n                columnNumber: 27\n              }, this) : null, /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"media-info\",\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"media-caption\",\n                  children: media.caption ? media.caption.substring(0, 100) + '...' : 'No caption'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 391,\n                  columnNumber: 27\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"media-date\",\n                  children: new Date(media.timestamp).toLocaleDateString()\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 394,\n                  columnNumber: 27\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 390,\n                columnNumber: 25\n              }, this)]\n            }, media.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 382,\n              columnNumber: 23\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 380,\n            columnNumber: 19\n          }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"No media found for this account.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 402,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 375,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 302,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 269,\n    columnNumber: 5\n  }, this);\n};\n_s(InstagramPage, \"eGefMEn68w2wkUk9n6X3/y98G2I=\");\n_c = InstagramPage;\nexport default InstagramPage;\nvar _c;\n$RefreshReg$(_c, \"InstagramPage\");","map":{"version":3,"names":["React","useState","useEffect","apiClient","jsxDEV","_jsxDEV","Fragment","_Fragment","InstagramPage","_s","isConnected","setIsConnected","instagramAccounts","setInstagramAccounts","selectedAccount","setSelectedAccount","postContent","setPostContent","postImage","setPostImage","loading","setLoading","message","setMessage","sdkLoaded","setSdkLoaded","fbAccessToken","setFbAccessToken","generatingAI","setGeneratingAI","userMedia","setUserMedia","loadingMedia","setLoadingMedia","INSTAGRAM_APP_ID","process","env","REACT_APP_INSTAGRAM_APP_ID","checkLoginStatus","window","FB","getLoginStatus","response","status","authResponse","accessToken","handleConnectInstagram","initializeFacebookSDK","init","appId","cookie","xfbml","version","fbAsyncInit","d","s","id","js","fjs","getElementsByTagName","getElementById","createElement","src","parentNode","insertBefore","document","connectInstagram","success","instagram_accounts","length","error","console","errorMessage","data","detail","handleFacebookLogin","login","scope","handleGenerateAIPost","createInstagramPost","instagram_user_id","access_token","use_ai","prompt","ai_content","_error$response","_error$response$data","handleCreatePost","trim","formData","FormData","append","loadUserMedia","_error$response2","_error$response2$data","instagramUserId","media","getInstagramMedia","_error$response3","_error$response3$data","handleAccountChange","accountId","handleImageChange","e","file","target","files","handleLogout","logout","className","children","fileName","_jsxFileName","lineNumber","columnNumber","includes","onClick","disabled","value","onChange","map","account","username","name","placeholder","rows","htmlFor","type","accept","slice","media_type","media_url","alt","controls","caption","substring","Date","timestamp","toLocaleDateString","_c","$RefreshReg$"],"sources":["F:/Projects/Automation Dashboard/frontend/src/components/InstagramPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport apiClient from '../services/apiClient';\r\nimport './SocialMediaPage.css';\r\n\r\nconst InstagramPage = () => {\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const [instagramAccounts, setInstagramAccounts] = useState([]);\r\n  const [selectedAccount, setSelectedAccount] = useState('');\r\n  const [postContent, setPostContent] = useState('');\r\n  const [postImage, setPostImage] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [message, setMessage] = useState('');\r\n  const [sdkLoaded, setSdkLoaded] = useState(false);\r\n  const [fbAccessToken, setFbAccessToken] = useState(null);\r\n  const [generatingAI, setGeneratingAI] = useState(false);\r\n  const [userMedia, setUserMedia] = useState([]);\r\n  const [loadingMedia, setLoadingMedia] = useState(false);\r\n\r\n  // Instagram App ID (different from Facebook App ID)\r\n  const INSTAGRAM_APP_ID = process.env.REACT_APP_INSTAGRAM_APP_ID || '697225659875731';\r\n\r\n  useEffect(() => {\r\n    const checkLoginStatus = () => {\r\n      if (!window.FB) return;\r\n      \r\n      window.FB.getLoginStatus((response) => {\r\n        if (response.status === 'connected') {\r\n          setFbAccessToken(response.authResponse.accessToken);\r\n          setMessage('Instagram: Using existing Facebook login session');\r\n          // Auto-connect Instagram accounts if we have a token\r\n          handleConnectInstagram(response.authResponse.accessToken);\r\n        }\r\n      });\r\n    };\r\n\r\n    const initializeFacebookSDK = () => {\r\n      // Always reinitialize with Instagram App ID to avoid conflicts\r\n      if (window.FB) {\r\n        // SDK already exists, reinitialize with Instagram App ID\r\n        window.FB.init({\r\n          appId: INSTAGRAM_APP_ID,\r\n          cookie: true,\r\n          xfbml: true,\r\n          version: 'v18.0'\r\n        });\r\n        setSdkLoaded(true);\r\n        checkLoginStatus();\r\n        return;\r\n      }\r\n\r\n      // Load FB SDK for the first time\r\n      window.fbAsyncInit = function() {\r\n        window.FB.init({\r\n          appId: INSTAGRAM_APP_ID,\r\n          cookie: true,\r\n          xfbml: true,\r\n          version: 'v18.0'\r\n        });\r\n        setSdkLoaded(true);\r\n        checkLoginStatus();\r\n      };\r\n\r\n      // Load the SDK script\r\n      (function(d, s, id) {\r\n        var js, fjs = d.getElementsByTagName(s)[0];\r\n        if (d.getElementById(id)) return;\r\n        js = d.createElement(s); js.id = id;\r\n        js.src = \"https://connect.facebook.net/en_US/sdk.js\";\r\n        fjs.parentNode.insertBefore(js, fjs);\r\n      }(document, 'script', 'facebook-jssdk'));\r\n    };\r\n\r\n    initializeFacebookSDK();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [INSTAGRAM_APP_ID]);\r\n\r\n  const handleConnectInstagram = async (accessToken = fbAccessToken) => {\r\n    if (!accessToken) {\r\n      setMessage('No access token available');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setMessage('Fetching Instagram Business accounts...');\r\n      \r\n      const response = await apiClient.connectInstagram(accessToken);\r\n\r\n      if (response.success && response.instagram_accounts && response.instagram_accounts.length > 0) {\r\n        setInstagramAccounts(response.instagram_accounts);\r\n        setIsConnected(true);\r\n        setMessage(`Found ${response.instagram_accounts.length} Instagram Business account(s)!`);\r\n        \r\n        // Auto-select first account if only one\r\n        if (response.instagram_accounts.length === 1) {\r\n          setSelectedAccount(response.instagram_accounts[0].id);\r\n        }\r\n      } else {\r\n        setMessage('No Instagram Business accounts found. Make sure you have an Instagram Business account connected to your Facebook Page.');\r\n      }\r\n    } catch (error) {\r\n      console.error('Instagram connection error:', error);\r\n      \r\n      // Better error handling to avoid [object Object] display\r\n      let errorMessage = 'Unknown error occurred';\r\n      \r\n      if (typeof error === 'string') {\r\n        errorMessage = error;\r\n      } else if (error.message) {\r\n        errorMessage = error.message;\r\n      } else if (error.response && error.response.data && error.response.data.detail) {\r\n        errorMessage = error.response.data.detail;\r\n      } else if (error.detail) {\r\n        errorMessage = error.detail;\r\n      }\r\n      \r\n      setMessage(`Error connecting Instagram: ${errorMessage}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleFacebookLogin = () => {\r\n    if (!window.FB) {\r\n      setMessage('Facebook SDK not loaded');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setMessage('Initiating Instagram OAuth via Facebook...');\r\n\r\n    // Instagram requires specific permissions\r\n    window.FB.login((response) => {\r\n      if (response.status === 'connected') {\r\n        const accessToken = response.authResponse.accessToken;\r\n        setFbAccessToken(accessToken);\r\n        setMessage('Facebook login successful! Connecting Instagram accounts...');\r\n        handleConnectInstagram(accessToken);\r\n      } else {\r\n        setMessage('Facebook login failed or was cancelled');\r\n        setLoading(false);\r\n      }\r\n    }, {\r\n      scope: 'pages_show_list,instagram_basic,instagram_content_publish,pages_read_engagement'\r\n    });\r\n  };\r\n\r\n  const handleGenerateAIPost = async () => {\r\n    if (!selectedAccount) {\r\n      setMessage('Please select an Instagram account first');\r\n      return;\r\n    }\r\n\r\n    setGeneratingAI(true);\r\n    setMessage('Generating AI post...');\r\n\r\n    try {\r\n      const response = await apiClient.createInstagramPost({\r\n        instagram_user_id: selectedAccount,\r\n        access_token: fbAccessToken,\r\n        use_ai: true,\r\n        prompt: 'Create an engaging Instagram post'\r\n      });\r\n\r\n      if (response.success) {\r\n        setPostContent(response.ai_content || '');\r\n        setMessage('AI post generated successfully!');\r\n      } else {\r\n        setMessage(`Failed to generate AI post: ${response.error}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('AI generation error:', error);\r\n      setMessage(`Error generating AI post: ${error.response?.data?.detail || error.message}`);\r\n    } finally {\r\n      setGeneratingAI(false);\r\n    }\r\n  };\r\n\r\n  const handleCreatePost = async () => {\r\n    if (!selectedAccount || !postContent.trim()) {\r\n      setMessage('Please select an account and enter post content');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setMessage('Creating Instagram post...');\r\n\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append('instagram_user_id', selectedAccount);\r\n      formData.append('access_token', fbAccessToken);\r\n      formData.append('caption', postContent);\r\n      formData.append('use_ai', 'false');\r\n\r\n      if (postImage) {\r\n        formData.append('image', postImage);\r\n      }\r\n\r\n      const response = await apiClient.createInstagramPost(formData);\r\n\r\n      if (response.success) {\r\n        setMessage('Instagram post created successfully!');\r\n        setPostContent('');\r\n        setPostImage(null);\r\n        // Refresh media after posting\r\n        if (selectedAccount) {\r\n          loadUserMedia(selectedAccount);\r\n        }\r\n      } else {\r\n        setMessage(`Failed to create post: ${response.error}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Post creation error:', error);\r\n      setMessage(`Error creating post: ${error.response?.data?.detail || error.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadUserMedia = async (instagramUserId) => {\r\n    setLoadingMedia(true);\r\n    try {\r\n      const media = await apiClient.getInstagramMedia(instagramUserId);\r\n      setUserMedia(media || []);\r\n    } catch (error) {\r\n      console.error('Error loading media:', error);\r\n      setMessage(`Error loading media: ${error.response?.data?.detail || error.message}`);\r\n    } finally {\r\n      setLoadingMedia(false);\r\n    }\r\n  };\r\n\r\n  const handleAccountChange = (accountId) => {\r\n    setSelectedAccount(accountId);\r\n    if (accountId) {\r\n      loadUserMedia(accountId);\r\n    }\r\n  };\r\n\r\n  const handleImageChange = (e) => {\r\n    const file = e.target.files[0];\r\n    if (file) {\r\n      setPostImage(file);\r\n    }\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    if (window.FB) {\r\n      window.FB.logout(() => {\r\n        setIsConnected(false);\r\n        setInstagramAccounts([]);\r\n        setSelectedAccount('');\r\n        setFbAccessToken(null);\r\n        setUserMedia([]);\r\n        setMessage('Logged out successfully');\r\n      });\r\n    }\r\n  };\r\n\r\n  if (!sdkLoaded) {\r\n    return (\r\n      <div className=\"social-media-page\">\r\n        <div className=\"loading\">Loading Instagram SDK...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"social-media-page\">\r\n      <div className=\"page-header\">\r\n        <h1>Instagram Management</h1>\r\n        <p>Connect and manage your Instagram Business accounts</p>\r\n      </div>\r\n\r\n      {message && (\r\n        <div className={`message ${message.includes('Error') || message.includes('Failed') ? 'error' : 'success'}`}>\r\n          {message}\r\n        </div>\r\n      )}\r\n\r\n      {!isConnected ? (\r\n        <div className=\"connection-section\">\r\n          <h2>Connect Instagram Account</h2>\r\n          <p>Connect your Instagram Business account through Facebook to start posting and managing content.</p>\r\n          <button \r\n            onClick={handleFacebookLogin} \r\n            disabled={loading}\r\n            className=\"connect-button\"\r\n          >\r\n            {loading ? 'Connecting...' : 'Connect Instagram via Facebook'}\r\n          </button>\r\n          <div className=\"instagram-requirements\">\r\n            <h3>Requirements:</h3>\r\n            <ul>\r\n              <li>Instagram Business or Creator account</li>\r\n              <li>Connected to a Facebook Page</li>\r\n              <li>Admin access to the Facebook Page</li>\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"connected-section\">\r\n          <div className=\"account-selection\">\r\n            <h2>Instagram Accounts</h2>\r\n            <select \r\n              value={selectedAccount} \r\n              onChange={(e) => handleAccountChange(e.target.value)}\r\n              className=\"account-select\"\r\n            >\r\n              <option value=\"\">Select an Instagram account</option>\r\n              {instagramAccounts.map(account => (\r\n                <option key={account.id} value={account.id}>\r\n                  {account.username} ({account.name})\r\n                </option>\r\n              ))}\r\n            </select>\r\n            \r\n            <button onClick={handleLogout} className=\"logout-button\">\r\n              Disconnect Instagram\r\n            </button>\r\n          </div>\r\n\r\n          {selectedAccount && (\r\n            <>\r\n              <div className=\"posting-section\">\r\n                <h2>Create Instagram Post</h2>\r\n                \r\n                <div className=\"ai-section\">\r\n                  <h3>AI-Generated Post</h3>\r\n                  <button \r\n                    onClick={handleGenerateAIPost}\r\n                    disabled={generatingAI || loading}\r\n                    className=\"ai-button\"\r\n                  >\r\n                    {generatingAI ? 'Generating...' : 'Generate AI Post'}\r\n                  </button>\r\n                </div>\r\n\r\n                <div className=\"manual-post-section\">\r\n                  <h3>Manual Post</h3>\r\n                  <textarea\r\n                    value={postContent}\r\n                    onChange={(e) => setPostContent(e.target.value)}\r\n                    placeholder=\"Enter your Instagram caption...\"\r\n                    rows=\"4\"\r\n                    className=\"post-textarea\"\r\n                  />\r\n                  \r\n                  <div className=\"image-upload\">\r\n                    <label htmlFor=\"image-upload\">Choose Image:</label>\r\n                    <input\r\n                      id=\"image-upload\"\r\n                      type=\"file\"\r\n                      accept=\"image/*\"\r\n                      onChange={handleImageChange}\r\n                      className=\"file-input\"\r\n                    />\r\n                    {postImage && (\r\n                      <div className=\"image-preview\">\r\n                        <p>Selected: {postImage.name}</p>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  <button \r\n                    onClick={handleCreatePost}\r\n                    disabled={loading || !postContent.trim()}\r\n                    className=\"post-button\"\r\n                  >\r\n                    {loading ? 'Posting...' : 'Create Post'}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"media-section\">\r\n                <h2>Recent Posts</h2>\r\n                {loadingMedia ? (\r\n                  <div className=\"loading\">Loading media...</div>\r\n                ) : userMedia.length > 0 ? (\r\n                  <div className=\"media-grid\">\r\n                    {userMedia.slice(0, 12).map((media) => (\r\n                      <div key={media.id} className=\"media-item\">\r\n                        {media.media_type === 'IMAGE' ? (\r\n                          <img src={media.media_url} alt=\"Instagram post\" />\r\n                        ) : media.media_type === 'VIDEO' ? (\r\n                          <video controls>\r\n                            <source src={media.media_url} type=\"video/mp4\" />\r\n                          </video>\r\n                        ) : null}\r\n                        <div className=\"media-info\">\r\n                          <p className=\"media-caption\">\r\n                            {media.caption ? media.caption.substring(0, 100) + '...' : 'No caption'}\r\n                          </p>\r\n                          <p className=\"media-date\">\r\n                            {new Date(media.timestamp).toLocaleDateString()}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                ) : (\r\n                  <p>No media found for this account.</p>\r\n                )}\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InstagramPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}